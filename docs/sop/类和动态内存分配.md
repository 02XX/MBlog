---
title: 类和动态内存分配
tags: []
categories:
  - [未分类]
date: 2023-04-04T00:49:29.000Z
updated: 2024-10-14T13:56:46.700Z
comments: false

---

<!--more-->
# 类和动态内存分配

c++自动提供以下成员函数（如果未在类中声明）

+ 默认构造函数
+ 默认析构函数
+ 复制构造函数
+ 赋值运算符
+ 地址运算符

## 复制构造函数

```c++
//头文件
class StringBad
{
    private:
    	char * str;
    public:
    	StringBad();
    	//StringBad(const StringBad &)   //复制构造函数    
    	~StringBad();
}
```

## 调用复制构造函数

```c++
//motto是StingBad的一个对象
StringBad a = motto;
StringBad a(motto);
StringBad a = StringBad(motto);
StringBad* p = new StringBad(motto);
```

## 默认的复制构造函数功能（浅复制）

默认的复制构造函数**复制成员的值**。例如

```c++
StringBad a("字符串");
StringBad b = a; //复制a
```

但是由于类中`str`是一个指针它的值是一个地址，所以复制的时候`a.str`的**值(地址)**会复制给`b.str`。因此他们的值(地址)相同，也就是指向同一个字符串。

![](E:\markdown\images\imgs\复制构造函数浅复制-1585629924652.png)

## 深复制

用户可以自己定义一个复制构造函数实现深复制。

```c++
StringBad::StringBad(const StringBad & s)
{
    std::strcpy(str, s.str); //拷贝副本
}
```

![](E:\markdown\images\imgs\复制构造函数深复制.png)

由于复制构造函数中使用了`strcpy`函数拷贝了一个字符副本并让`str`指向这个副本，所以这是一个深复制。